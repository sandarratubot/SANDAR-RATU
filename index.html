<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SANDAR-RATU - Sistem Administrasi & Dokumen Kesyahbandaran</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://apis.google.com/js/api.js"></script>
<style>
/* CSS Styles */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',sans-serif;background:#f8f9fa;min-height:100vh;display:flex;justify-content:center;align-items:center;transition:background 0.3s ease;}

/* Login Styles */
.login-container{
  background:#fff;
  border-radius:20px;
  box-shadow:0 20px 60px rgba(0,0,0,0.15);
  max-width:420px;
  width:100%;
  overflow:hidden;
  animation:slideIn 0.6s ease-out;
}
@keyframes slideIn { from { opacity:0; transform:translateY(-30px); } to { opacity:1; transform:translateY(0); } }
.logo-section{
  text-align:center;
  padding:40px 30px 20px;
  background:linear-gradient(135deg,#667eea 0%, #764ba2 100%);
  position:relative;
  overflow:hidden;
}
.logo-section::before {
  content:'';
  position:absolute;
  top:-50%;
  left:-50%;
  width:200%;
  height:200%;
  background:radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  animation:rotate 20s linear infinite;
}
@keyframes rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.logo{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  font-size:28px;
  font-weight:800;
  color:#fff;
  text-decoration:none;
  position:relative;
  z-index:2;
  text-shadow:2px 2px 4px rgba(0,0,0,0.3);
}
.logo-icon{
  width:40px;
  height:40px;
  background:rgba(255,255,255,0.2);
  backdrop-filter:blur(10px);
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:20px;
  border:2px solid rgba(255,255,255,0.3);
  animation:pulse 2s infinite;
}
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
.warning-section{
  background:linear-gradient(135deg, #fef9e7, #fefcf3);
  border:1px solid #f4d03f;
  margin:20px;
  border-radius:12px;
  padding:20px;
  text-align:center;
  box-shadow:inset 0 2px 10px rgba(244,208,63,0.1);
}
.warning-title{
  background:#fff;
  border:2px solid #f39c12;
  color:#d35400;
  padding:10px 20px;
  border-radius:25px;
  font-weight:700;
  margin-bottom:15px;
  display:inline-block;
  box-shadow:0 4px 15px rgba(243,156,18,0.2);
}
.warning-text{
  color:#8b4513;
  font-size:14px;
  line-height:1.6;
  margin-bottom:15px;
  font-weight:500;
}
.login-method-section{
  padding:25px;
  text-align:center;
}
.method-title{
  color:#6c757d;
  font-size:13px;
  margin-bottom:20px;
  font-style:italic;
  letter-spacing:0.5px;
}
.google-login-btn{
  width:100%;
  padding:15px 20px;
  border:2px solid #e0e0e0;
  background:#fff;
  border-radius:50px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  font-size:15px;
  font-weight:600;
  color:#5f6368;
  cursor:pointer;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position:relative;
  overflow:hidden;
}
.google-login-btn::before {
  content:'';
  position:absolute;
  top:50%;
  left:50%;
  width:0;
  height:0;
  background:radial-gradient(circle, rgba(26,115,232,0.1) 0%, transparent 70%);
  border-radius:50%;
  transform:translate(-50%, -50%);
  transition:width 0.3s ease, height 0.3s ease;
}
.google-login-btn:hover::before { width:300px; height:300px; }
.google-login-btn:hover{ border-color:#1a73e8; box-shadow:0 8px 25px rgba(26,115,232,0.15); transform:translateY(-2px); }
.google-login-btn:active { transform:translateY(0); }
.google-login-btn:disabled{ opacity:0.6; cursor:not-allowed; transform:none; }
.google-icon{ width:20px; height:20px; }
.spinner {
  border: 2px solid #f3f3f3;
  border-top: 2px solid #1a73e8;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  animation: spin 1s linear infinite;
  display: none;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
/* Dashboard Styles */
.dashboard{display:none;flex-direction:column;height:100vh;width:100%;background:#f8f9fa;}
.header{
  background:linear-gradient(135deg, #2c3e50, #34495e);
  color:white;
  height:70px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 25px;
  box-shadow:0 4px 20px rgba(0,0,0,0.1);
  position:relative;
}
.header::after {
  content:'';
  position:absolute;
  bottom:0;
  left:0;
  width:100%;
  height:3px;
  background:linear-gradient(90deg, #3498db, #2ecc71, #f39c12, #e74c3c);
}
.header .logo-icon{
  background:linear-gradient(135deg, #3498db, #2ecc71);
  width:42px;
  height:42px;
  border-radius:12px;
  display:flex;
  justify-content:center;
  align-items:center;
  margin-right:12px;
  box-shadow:0 4px 15px rgba(52,152,219,0.3);
}
.header .user-info{
  display:flex;
  align-items:center;
  gap:15px;
  background:rgba(255,255,255,0.1);
  padding:8px 15px;
  border-radius:25px;
  backdrop-filter:blur(10px);
}
.header .user-avatar{
  width:36px;
  height:36px;
  border-radius:50%;
  border:3px solid #3498db;
  transition:transform 0.3s ease;
}
.header .user-avatar:hover { transform:scale(1.1); }
.header .user-name { font-weight:600; font-size:14px; }
.main-container{display:flex;flex:1;overflow:hidden;}
.sidebar{
  width:260px;
  background:linear-gradient(180deg, #3498db, #2980b9);
  color:white;
  padding-top:20px;
  box-shadow:4px 0 20px rgba(0,0,0,0.1);
  overflow-y:auto;
}
.sidebar div{
  padding:12px 25px;
  font-weight:700;
  opacity:0.9;
  font-size:13px;
  letter-spacing:0.5px;
  background:rgba(0,0,0,0.1);
  margin:5px 15px;
  border-radius:8px;
  text-transform:uppercase;
}
.sidebar a{
  display:flex;
  align-items:center;
  padding:15px 25px;
  color:white;
  text-decoration:none;
  transition:all 0.3s ease;
  cursor:pointer;
  position:relative;
  border-left:4px solid transparent;
}
.sidebar a::before {
  content:'';
  position:absolute;
  left:0;
  top:0;
  width:0;
  height:100%;
  background:rgba(255,255,255,0.1);
  transition:width 0.3s ease;
}
.sidebar a:hover::before { width:100%; }
.sidebar a:hover{ background:rgba(255,255,255,0.15); border-left-color:#fff; transform:translateX(5px); }
.sidebar a.active{
  background:rgba(0,0,0,0.2);
  font-weight:bold;
  border-left-color:#f39c12;
  box-shadow:inset 0 0 20px rgba(0,0,0,0.2);
}
.sidebar a i { margin-right:12px; width:20px; text-align:center; }
.content{
  flex:1;
  padding:30px;
  overflow-y:auto;
  background:#f8f9fa;
  position:relative;
}
.content h2{
  margin-bottom:25px;
  color:#2c3e50;
  font-size:28px;
  font-weight:700;
  position:relative;
  padding-bottom:10px;
}
.content h2::after {
  content:'';
  position:absolute;
  bottom:0;
  left:0;
  width:50px;
  height:4px;
  background:linear-gradient(90deg, #3498db, #2ecc71);
  border-radius:2px;
}
.card{
  background:white;
  padding:30px;
  border-radius:15px;
  margin-bottom:25px;
  box-shadow:0 10px 40px rgba(0,0,0,0.08);
  border:1px solid #e9ecef;
  transition:transform 0.3s ease, box-shadow 0.3s ease;
  position:relative;
  overflow:hidden;
}
.card::before {
  content:'';
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:4px;
  background:linear-gradient(90deg, #667eea, #764ba2);
}
.card:hover { transform:translateY(-5px); box-shadow:0 15px 50px rgba(0,0,0,0.12); }
.form-row{display:flex;gap:20px;margin-bottom:20px;}
.form-row .form-control{flex:1;}
.form-control{
  width:100%;
  padding:15px 18px;
  margin-bottom:20px;
  border:2px solid #e9ecef;
  border-radius:10px;
  font-size:14px;
  transition:all 0.3s ease;
  background:#fff;
}
.form-control:focus {
  outline:none;
  border-color:#3498db;
  box-shadow:0 0 20px rgba(52,152,219,0.1);
  transform:translateY(-2px);
}
.form-control::placeholder { color:#adb5bd; }
.btn-generate{
  width:100%;
  padding:15px;
  background:linear-gradient(135deg, #2ecc71, #27ae60);
  border:none;
  color:white;
  border-radius:50px;
  font-weight:700;
  cursor:pointer;
  margin-bottom:15px;
  font-size:15px;
  transition:all 0.3s ease;
  box-shadow:0 6px 20px rgba(46,204,113,0.3);
  position:relative;
  overflow:hidden;
}
.btn-generate::before {
  content:'';
  position:absolute;
  top:50%;
  left:50%;
  width:0;
  height:0;
  background:rgba(255,255,255,0.2);
  border-radius:50%;
  transform:translate(-50%, -50%);
  transition:width 0.4s ease, height 0.4s ease;
}
.btn-generate:hover::before { width:300px; height:300px; }
.btn-generate:hover{
  background:linear-gradient(135deg, #27ae60, #229954);
  transform:translateY(-3px);
  box-shadow:0 10px 30px rgba(46,204,113,0.4);
}
.btn-upload-drive{
  width:100%;
  padding:15px;
  background:linear-gradient(135deg, #1a73e8, #1557b0);
  border:none;
  color:white;
  border-radius:50px;
  font-weight:700;
  cursor:pointer;
  margin-bottom:15px;
  font-size:15px;
  transition:all 0.3s ease;
  box-shadow:0 6px 20px rgba(26,115,232,0.3);
  position:relative;
  overflow:hidden;
}
.btn-upload-drive::before {
  content:'';
  position:absolute;
  top:50%;
  left:50%;
  width:0;
  height:0;
  background:rgba(255,255,255,0.2);
  border-radius:50%;
  transform:translate(-50%, -50%);
  transition:width 0.4s ease, height 0.4s ease;
}
.btn-upload-drive:hover::before { width:300px; height:300px; }
.btn-upload-drive:hover{
  background:linear-gradient(135deg, #1557b0, #0d47a1);
  transform:translateY(-3px);
  box-shadow:0 10px 30px rgba(26,115,232,0.4);
}
.btn-upload-drive:disabled{
  background:#94a3b8;
  cursor:not-allowed;
  transform:none;
  box-shadow:none;
}
.btn-logout{
  background:linear-gradient(135deg, #e74c3c, #c0392b);
  color:#fff;
  border:none;
  padding:10px 20px;
  border-radius:25px;
  cursor:pointer;
  font-weight:600;
  transition:all 0.3s ease;
  box-shadow:0 4px 15px rgba(231,76,60,0.3);
}
.btn-logout:hover {
  background:linear-gradient(135deg, #c0392b, #a93226);
  transform:translateY(-2px);
  box-shadow:0 6px 20px rgba(231,76,60,0.4);
}
.result-container{margin-top:20px;}
.preview-container{
  margin-top:15px;
  padding:20px;
  background:#f8f9fa;
  border:2px dashed #dee2e6;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  gap:15px;
  transition:all 0.3s ease;
}
.preview-container:hover { border-color:#3498db; background:#f1f8ff; }
.document-info{
  background:#fff;
  padding:15px;
  border-radius:8px;
  border-left:5px solid #3498db;
  box-shadow:0 2px 10px rgba(0,0,0,0.05);
}
.document-info h4{ color:#2c3e50; margin-bottom:8px; font-size:16px; }
.document-info p{ color:#7f8c8d; font-size:13px; line-height:1.4; }
.preview-container embed,.preview-container img{
  width:100%;
  max-height:350px;
  border-radius:8px;
  object-fit:contain;
  border:2px solid #e9ecef;
  box-shadow:0 4px 15px rgba(0,0,0,0.1);
}
.preview-container a{
  align-self:flex-start;
  text-decoration:none;
  color:#fff;
  font-weight:600;
  padding:10px 20px;
  background:linear-gradient(135deg, #2980b9, #3498db);
  border-radius:25px;
  transition:all 0.3s ease;
  box-shadow:0 4px 15px rgba(52,152,219,0.3);
}
.preview-container a:hover {
  background:linear-gradient(135deg, #1f618d, #2980b9);
  transform:translateY(-2px);
  box-shadow:0 6px 20px rgba(52,152,219,0.4);
}
.qr-section{
  background:linear-gradient(135deg, #fff, #f8f9fa);
  padding:25px;
  border-radius:15px;
  text-align:center;
  border:3px solid #3498db;
  margin-bottom:20px;
  box-shadow:0 10px 30px rgba(52,152,219,0.1);
}
.qr-section h3{ color:#2c3e50; margin-bottom:15px; font-size:20px; font-weight:700; }
.qr-info{
  background:linear-gradient(135deg, #e8f6ff, #f0f9ff);
  padding:15px;
  border-radius:10px;
  margin-top:15px;
  border:2px solid #3498db;
  box-shadow:inset 0 2px 10px rgba(52,152,219,0.1);
}
.qr-info p{ margin:5px 0; font-size:13px; color:#2c3e50; font-weight:500; }
.qr-url{
  background:#fff;
  padding:12px;
  margin:8px 0;
  border-radius:8px;
  word-break:break-all;
  font-family:'Courier New', monospace;
  font-size:12px;
  border:2px solid #bdc3c7;
  max-height:80px;
  overflow-y:auto;
  box-shadow:inset 0 2px 5px rgba(0,0,0,0.1);
}
.document-summary{
  background:linear-gradient(135deg, #fff, #f8fffe);
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
  border-left:5px solid #27ae60;
  box-shadow:0 6px 20px rgba(39,174,96,0.1);
}
.document-summary h3{ color:#2c3e50; margin-bottom:15px; font-size:18px; font-weight:700; }
.document-summary table{ width:100%; border-collapse:collapse; }
.document-summary table td{ padding:8px 12px; border-bottom:1px solid #ecf0f1; vertical-align:top; }
.document-summary table td:first-child{ font-weight:700; width:35%; color:#34495e; }
.form-type-indicator{
  background:linear-gradient(135deg, #e8f4f8, #d5edf5);
  border:3px solid #3498db;
  padding:15px;
  border-radius:12px;
  margin-bottom:20px;
  text-align:center;
  box-shadow:0 4px 15px rgba(52,152,219,0.1);
}
.form-type-indicator h3{ color:#2c3e50; margin:0; font-size:18px; font-weight:700; }
.test-qr-btn{
  background:linear-gradient(135deg, #e74c3c, #c0392b);
  color:white;
  border:none;
  padding:8px 15px;
  border-radius:20px;
  cursor:pointer;
  margin:5px;
  font-size:12px;
  font-weight:600;
  transition:all 0.3s ease;
  box-shadow:0 3px 10px rgba(231,76,60,0.3);
}
.test-qr-btn:hover{
  background:linear-gradient(135deg, #c0392b, #a93226);
  transform:translateY(-2px);
  box-shadow:0 5px 15px rgba(231,76,60,0.4);
}
.content-page{display:none;}
.content-page.active{display:block;}
.document-label{
  display:block;
  margin-bottom:15px;
  font-weight:700;
  color:#2c3e50;
  font-size:14px;
}
.document-label input{
  margin-top:8px;
  border:2px dashed #bdc3c7;
  transition:all 0.3s ease;
}
.document-label input:hover { border-color:#3498db; }
.upload-status{
  background:linear-gradient(135deg, #e8f5e8, #d4edda);
  border:2px solid #4caf50;
  color:#155724;
  padding:15px;
  border-radius:10px;
  margin:15px 0;
  display:none;
  box-shadow:0 4px 15px rgba(76,175,80,0.2);
}
.upload-error{
  background:linear-gradient(135deg, #ffebee, #f8d7da);
  border:2px solid #f44336;
  color:#721c24;
  padding:15px;
  border-radius:10px;
  margin:15px 0;
  display:none;
  box-shadow:0 4px 15px rgba(244,67,54,0.2);
}
.google-drive-status{
  background:linear-gradient(135deg, #e3f2fd, #e1f5fe);
  border:2px solid #2196f3;
  color:#0d47a1;
  padding:15px;
  border-radius:10px;
  margin:15px 0;
  text-align:center;
  font-weight:600;
  box-shadow:0 4px 15px rgba(33,150,243,0.2);
}
.progress-bar{
  width:100%;
  background:#e9ecef;
  border-radius:25px;
  overflow:hidden;
  margin:15px 0;
  display:none;
  box-shadow:inset 0 2px 5px rgba(0,0,0,0.1);
}
.progress-fill{
  height:25px;
  background:linear-gradient(90deg, #4caf50, #8bc34a);
  border-radius:25px;
  transition:width 0.3s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:13px;
  font-weight:700;
  box-shadow:0 2px 10px rgba(76,175,80,0.3);
}
.footer-login{
  text-align:center;
  padding:20px;
  color:#6c757d;
  font-size:12px;
  border-top:1px solid #e9ecef;
  background:#f8f9fa;
  font-weight:500;
}
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 15px 20px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  border-left: 5px solid #4caf50;
  z-index: 10000;
  transform: translateX(400px);
  transition: transform 0.3s ease;
}
.notification.show { transform: translateX(0); }
.notification.error { border-left-color: #f44336; }
.notification.warning { border-left-color: #ff9800; }
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255,255,255,0.9);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.loading-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid #e9ecef;
  border-top: 4px solid #3498db;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
/* Responsive Design */
@media (max-width: 768px) {
  .sidebar { width: 100%; height: auto; }
  .main-container { flex-direction: column; }
  .form-row { flex-direction: column; }
  .login-container { margin: 20px; }
  .content { padding: 20px; }
  .card { padding: 20px; }
}
/* Dark mode toggle */
.dark-mode-toggle {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  padding: 8px 12px;
  border-radius: 20px;
  cursor: pointer;
  margin-right: 15px;
  transition: all 0.3s ease;
}
.dark-mode-toggle:hover { background: rgba(255,255,255,0.3); }
/* Validation styles */
.form-control.invalid { border-color: #e74c3c; box-shadow: 0 0 10px rgba(231,76,60,0.3); }
.form-control.valid { border-color: #27ae60; box-shadow: 0 0 10px rgba(39,174,96,0.3); }
.validation-message {
  font-size: 12px;
  margin-top: 5px;
  padding: 5px 10px;
  border-radius: 5px;
  display: none;
}
.validation-message.error { background: #ffebee; color: #c62828; border: 1px solid #f44336; }
.validation-message.success { background: #e8f5e8; color: #2e7d32; border: 1px solid #4caf50; }
</style>
</head>
<body>

<div id="loadingOverlay" class="loading-overlay">
  <div class="loading-spinner"></div>
</div>

<div id="loginPage" class="login-container">
  <div class="logo-section">
    <a href="#" class="logo">
      <div class="logo-icon">
        <i class="fas fa-anchor"></i>
      </div>
      SANDAR-RATU
    </a>
  </div>
  
  <div class="warning-section">
    <div class="warning-title">üîí Peringatan Keamanan</div>
    <div class="warning-text">
      Halaman ini memerlukan autentikasi Google untuk mengakses sistem administrasi pelabuhan.<br>
      Silakan klik tombol login di bawah untuk melanjutkan.<br>
      <strong>Terima kasih atas kerja sama Anda.</strong>
    </div>
  </div>
  
  <div class="login-method-section">
    <div class="method-title">- pilih metode login -</div>
    <button id="googleLoginBtn" class="google-login-btn">
      <div class="spinner" id="loginSpinner"></div>
      <svg class="google-icon" viewBox="0 0 24 24">
        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
      </svg>
      <span id="loginBtnText">Log in with Google</span>
    </button>
  </div>
  
  <div class="footer-login">Hak Cipta ¬© 2025 Sandar-Ratu | PPN Palabuhanratu</div>
</div>

<div id="dashboard" class="dashboard">
  <div class="header">
    <div style="display:flex;align-items:center;">
      <div class="logo-icon"><i class="fas fa-anchor"></i></div>
      <strong>SANDAR-RATU</strong>
    </div>
    <div style="display:flex;align-items:center;gap:15px;">
      <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
        <i class="fas fa-moon"></i>
      </button>
      <div class="user-info">
        <img id="userAvatar" class="user-avatar" src="" alt="User">
        <div>
          <div class="user-name" id="userName">User</div>
          <div style="font-size:11px;opacity:0.8;" id="userEmail">email@domain.com</div>
        </div>
      </div>
      <button class="btn-logout" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Keluar
      </button>
    </div>
  </div>
  <div class="main-container">
    <div class="sidebar">
      <div>üë®‚Äç‚úàÔ∏è PETUGAS SYAHBANDAR</div>
      <a onclick="showPage('departurePetugas', this)">
        <i class="fas fa-ship"></i> Keberangkatan Kapal
      </a>
      <a onclick="showPage('arrivalPetugas', this)">
        <i class="fas fa-anchor"></i> Kedatangan Kapal
      </a>
      <div>üö¢ IZIN NELAYAN</div>
      <a onclick="showPage('departureNelayan', this)">
        <i class="fas fa-fish"></i> Keberangkatan Nelayan
      </a>
      <a onclick="showPage('arrivalNelayan', this)">
        <i class="fas fa-water"></i> Kedatangan Nelayan
      </a>
      <div>üìä LAPORAN & DATA</div>
      <a onclick="showPage('reports', this)">
        <i class="fas fa-chart-bar"></i> Statistik & Laporan
      </a>
      <a onclick="showPage('settings', this)">
        <i class="fas fa-cog"></i> Pengaturan Sistem
      </a>
    </div>

    <div class="content" id="mainContent">
      </div>
  </div>
</div>

<script>
    const CLIENT_ID = "800620913330-fahu605bu7d8v877pbgaijvp0shrc3cf.apps.googleusercontent.com";
    const API_KEY = "AIzaSyDvNWYW_BNTF-sftpmff3jWyL9BeP6-qMg";
    const SCOPES = "https://www.googleapis.com/auth/drive.file";

    const FOLDER_MAP = {
        "Petugas-Keberangkatan": "1Ws2ctYHbdUD7Wza2ld4KxO0j7fiFcg3o",
        "Petugas-Kedatangan": "1BIDQw9AMiY5_Mxt1OBKC1Lce3xzjtfTz",
        "Nelayan-Keberangkatan": "1bnyimhbu884iAdNX75u_MxtPN2azgAFy",
        "Nelayan-Kedatangan": "1Yt_-nTkJrZNO7Y2ZlBJIqebnMu0ncE-M"
    };

// Global variables
let isGoogleAPIReady = false;
let authInstance = null;
let currentUser = null;
let accessToken = null;
let isDarkMode = false;
let sessionStats = {
    documentsGenerated: 0,
    filesUploaded: 0,
    sessionStart: new Date()
};

// Utility Functions
function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div style="display:flex;align-items:center;gap:10px;">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => notification.classList.add('show'), 100);
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => document.body.removeChild(notification), 300);
    }, 4000);
}

function showLoading(show = true) {
    const overlay = document.getElementById('loadingOverlay');
    overlay.style.display = show ? 'flex' : 'none';
}

function validateForm(form) {
    let isValid = true;
    const requiredFields = form.querySelectorAll('[required]');
    
    requiredFields.forEach(field => {
        const validationMsg = field.nextElementSibling?.classList.contains('validation-message') 
            ? field.nextElementSibling 
            : null;
        
        if (!field.value.trim()) {
            field.classList.add('invalid');
            field.classList.remove('valid');
            if (validationMsg) {
                validationMsg.textContent = 'Field ini wajib diisi';
                validationMsg.className = 'validation-message error';
                validationMsg.style.display = 'block';
            }
            isValid = false;
        } else {
            field.classList.remove('invalid');
            field.classList.add('valid');
            if (validationMsg) {
                validationMsg.style.display = 'none';
            }
        }
    });
    
    return isValid;
}

function formatFileSize(bytes) {
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    if (bytes === 0) return '0 Bytes';
    const i = Math.floor(Math.log(bytes) / Math.log(1024));
    return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
}

function generateDocumentCode(shipName, date, time) {
    const cleanShipName = shipName.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
    const formattedDate = date.replace(/-/g, '');
    const formattedTime = time.replace(':', '');
    return `SANDAR-${cleanShipName}-${formattedDate}-${formattedTime}`;
}

// Initialize Google APIs
function initializeGoogleAuth() {
    console.log('Initializing Google Auth...');
    
    gapi.load('client:auth2', async () => {
        try {
            await gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                scope: SCOPES
            });
            authInstance = gapi.auth2.getAuthInstance();
            isGoogleAPIReady = true;
            console.log('Google Auth initialized successfully');
            showNotification('Google Auth berhasil diinisialisasi', 'success');
            // Update UI
            const loginBtn = document.getElementById('googleLoginBtn');
            loginBtn.disabled = false;
            document.getElementById('loginBtnText').textContent = 'Log in with Google';
            document.getElementById('loginSpinner').style.display = 'none';
            // Check if user is already signed in
            if (authInstance.isSignedIn.get()) {
                const currentGoogleUser = authInstance.currentUser.get();
                await handleSignInSuccess(currentGoogleUser);
            }
        } catch (error) {
            console.error('Error initializing Google Auth:', error);
            showNotification('Gagal menginisialisasi Google Auth: ' + error.message, 'error');
            // Reset button
            const loginBtn = document.getElementById('googleLoginBtn');
            loginBtn.disabled = false;
            document.getElementById('loginBtnText').textContent = 'Retry Login';
            document.getElementById('loginSpinner').style.display = 'none';
        }
    });
}

// Handle successful sign in
async function handleSignInSuccess(googleUser) {
    try {
        showLoading(true);
        const profile = googleUser.getBasicProfile();
        const authResponse = googleUser.getAuthResponse();
        accessToken = authResponse.access_token;
        currentUser = {
            id: profile.getId(),
            name: profile.getName(),
            email: profile.getEmail(),
            picture: profile.getImageUrl()
        };
        console.log('User signed in:', currentUser);
        sessionStats.sessionStart = new Date();
        showDashboard();
        showNotification(`Selamat datang, ${currentUser.name}!`, 'success');
    } catch (error) {
        console.error('Error handling sign in:', error);
        showNotification('Gagal memproses login: ' + error.message, 'error');
    } finally {
        showLoading(false);
    }
}

// Google Login Button Click Handler
document.getElementById('googleLoginBtn').addEventListener('click', async function() {
    if (!isGoogleAPIReady) {
        showNotification('Google API belum siap. Mohon tunggu...', 'warning');
        return;
    }
    try {
        this.disabled = true;
        document.getElementById('loginBtnText').textContent = 'Signing in...';
        document.getElementById('loginSpinner').style.display = 'inline-block';
        const googleUser = await authInstance.signIn();
        await handleSignInSuccess(googleUser);
    } catch (error) {
        console.error('Sign in error:', error);
        showNotification('Login gagal: ' + error.message, 'error');
        // Reset button
        this.disabled = false;
        document.getElementById('loginBtnText').textContent = 'Log in with Google';
        document.getElementById('loginSpinner').style.display = 'none';
    }
});

// Show dashboard after successful login
function showDashboard() {
    if (!currentUser) {
        showNotification('Login gagal, silakan coba lagi', 'error');
        return;
    }
    // Update UI with user info
    document.getElementById('userName').textContent = currentUser.name;
    document.getElementById('userEmail').textContent = currentUser.email;
    document.getElementById('userAvatar').src = currentUser.picture;
    // Show dashboard
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("dashboard").style.display = "flex";
    document.body.style.background = "white";
    // Initialize pages and show first page
    initializePages();
    showPage('departurePetugas', document.querySelector(".sidebar a"));
    updateGoogleDriveStatus();
}

// Update Google Drive connection status
function updateGoogleDriveStatus(errorMsg = null) {
    const statusElements = document.querySelectorAll('.google-drive-status');
    statusElements.forEach(el => {
        if (errorMsg) {
            el.style.background = 'linear-gradient(135deg, #ffebee, #f8d7da)';
            el.style.borderColor = '#f44336';
            el.style.color = '#c62828';
            el.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${errorMsg}`;
        } else if (isGoogleAPIReady && authInstance && authInstance.isSignedIn.get()) {
            el.style.background = 'linear-gradient(135deg, #e8f5e8, #d4edda)';
            el.style.borderColor = '#4caf50';
            el.style.color = '#2e7d32';
            el.innerHTML = `<i class="fas fa-check-circle"></i> Google Drive terhubung dan siap digunakan`;
        } else {
            el.style.background = 'linear-gradient(135deg, #e3f2fd, #e1f5fe)';
            el.style.borderColor = '#2196f3';
            el.style.color = '#1565c0';
            el.innerHTML = `<i class="fas fa-info-circle"></i> Google Drive siap digunakan`;
        }
    });
}

// Upload file to Google Drive with progress
async function uploadFileToGoogleDrive(file, folderId, fileName, onProgress = null) {
    if (!accessToken) {
        throw new Error('Access token tidak tersedia');
    }
    const metadata = { name: fileName, parents: [folderId] };
    const form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
    form.append('file', file);
    const xhr = new XMLHttpRequest();
    return new Promise((resolve, reject) => {
        xhr.upload.addEventListener('progress', (e) => {
            if (e.lengthComputable && onProgress) {
                const percentComplete = (e.loaded / e.total) * 100;
                onProgress(percentComplete);
            }
        });
        xhr.addEventListener('load', () => {
            if (xhr.status >= 200 && xhr.status < 300) {
                resolve(JSON.parse(xhr.responseText));
            } else {
                reject(new Error(`HTTP ${xhr.status}: ${xhr.statusText}`));
            }
        });
        xhr.addEventListener('error', () => {
            reject(new Error('Network error'));
        });
        xhr.open('POST', 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart');
        xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken);
        xhr.send(form);
    });
}

// Enhanced logout function
function logout() {
    if (confirm('Apakah Anda yakin ingin keluar dari sistem?')) {
        try {
            showLoading(true);
            // Sign out from Google
            if (authInstance && authInstance.isSignedIn.get()) {
                authInstance.signOut();
            }
            // Reset variables
            currentUser = null;
            accessToken = null;
            sessionStats = { documentsGenerated: 0, filesUploaded: 0, sessionStart: new Date() };
            // Show login page
            document.getElementById("dashboard").style.display = "none";
            document.getElementById("loginPage").style.display = "block";
            document.body.style.background = "#f8f9fa";
            // Clear content
            document.getElementById("mainContent").innerHTML = "";
            showNotification('Berhasil keluar dari sistem', 'success');
            console.log('User signed out successfully');
        } catch (error) {
            console.error('Error during logout:', error);
            showNotification('Terjadi error saat logout: ' + error.message, 'error');
        } finally {
            showLoading(false);
        }
    }
}

// Dark mode toggle
function toggleDarkMode() {
    isDarkMode = !isDarkMode;
    const body = document.body;
    const toggle = document.querySelector('.dark-mode-toggle i');
    if (isDarkMode) {
        body.style.filter = 'invert(1) hue-rotate(180deg)';
        toggle.className = 'fas fa-sun';
    } else {
        body.style.filter = 'none';
        toggle.className = 'fas fa-moon';
    }
}

// Dashboard Page Rendering
const PAGES = {
    'departurePetugas': {
        title: 'Form Keberangkatan Kapal (Petugas)',
        formId: 'departurePetugasForm',
        folderKey: 'Petugas-Keberangkatan',
        fields: [
            { id: 'dp_shipName', label: 'Nama Kapal', type: 'text', required: true },
            { id: 'dp_shipType', label: 'Jenis Kapal', type: 'text', required: true },
            { id: 'dp_captainName', label: 'Nama Nakhoda', type: 'text', required: true },
            { id: 'dp_crewCount', label: 'Jumlah Kru', type: 'number', required: true },
            { id: 'dp_destination', label: 'Tujuan', type: 'text', required: true },
            { id: 'dp_cargo', label: 'Muatan', type: 'text', required: true },
            { id: 'dp_departureDate', label: 'Tanggal Keberangkatan', type: 'date', required: true },
            { id: 'dp_departureTime', label: 'Waktu Keberangkatan', type: 'time', required: true }
        ]
    },
    'arrivalPetugas': {
        title: 'Form Kedatangan Kapal (Petugas)',
        formId: 'arrivalPetugasForm',
        folderKey: 'Petugas-Kedatangan',
        fields: [
            { id: 'ap_shipName', label: 'Nama Kapal', type: 'text', required: true },
            { id: 'ap_shipType', label: 'Jenis Kapal', type: 'text', required: true },
            { id: 'ap_captainName', label: 'Nama Nakhoda', type: 'text', required: true },
            { id: 'ap_crewCount', label: 'Jumlah Kru', type: 'number', required: true },
            { id: 'ap_origin', label: 'Asal', type: 'text', required: true },
            { id: 'ap_cargo', label: 'Muatan', type: 'text', required: true },
            { id: 'ap_arrivalDate', label: 'Tanggal Kedatangan', type: 'date', required: true },
            { id: 'ap_arrivalTime', label: 'Waktu Kedatangan', type: 'time', required: true }
        ]
    },
    'departureNelayan': {
        title: 'Form Keberangkatan Nelayan',
        formId: 'departureNelayanForm',
        folderKey: 'Nelayan-Keberangkatan',
        fields: [
            { id: 'dn_fishermanName', label: 'Nama Nelayan', type: 'text', required: true },
            { id: 'dn_boatName', label: 'Nama Kapal', type: 'text', required: true },
            { id: 'dn_boatSize', label: 'Ukuran Kapal', type: 'text', required: true },
            { id: 'dn_crewCount', label: 'Jumlah Kru', type: 'number', required: true },
            { id: 'dn_fishingArea', label: 'Area Penangkap Ikan', type: 'text', required: true },
            { id: 'dn_departureDate', label: 'Tanggal Keberangkatan', type: 'date', required: true },
            { id: 'dn_departureTime', label: 'Waktu Keberangkatan', type: 'time', required: true }
        ]
    },
    'arrivalNelayan': {
        title: 'Form Kedatangan Nelayan',
        formId: 'arrivalNelayanForm',
        folderKey: 'Nelayan-Kedatangan',
        fields: [
            { id: 'an_fishermanName', label: 'Nama Nelayan', type: 'text', required: true },
            { id: 'an_boatName', label: 'Nama Kapal', type: 'text', required: true },
            { id: 'an_catchWeight', label: 'Berat Tangkapan (Kg)', type: 'number', required: true },
            { id: 'an_arrivalDate', label: 'Tanggal Kedatangan', type: 'date', required: true },
            { id: 'an_arrivalTime', label: 'Waktu Kedatangan', type: 'time', required: true }
        ]
    },
    'reports': {
        title: 'Statistik & Laporan',
        html: `
        <div class="card">
            <h3>üìä Statistik Sesi Ini</h3>
            <table>
                <tr>
                    <td>Dokumen Dibuat:</td>
                    <td><strong id="statDocs">0</strong></td>
                </tr>
                <tr>
                    <td>File Diunggah:</td>
                    <td><strong id="statFiles">0</strong></td>
                </tr>
                <tr>
                    <td>Durasi Sesi:</td>
                    <td><strong id="statDuration">0 menit</strong></td>
                </tr>
            </table>
        </div>
        <div class="card">
            <h3>üìù Catatan Penting</h3>
            <p>Fungsi laporan yang lebih komprehensif akan tersedia di versi mendatang. Saat ini, statistik sesi hanya menampilkan ringkasan aktivitas Anda.</p>
        </div>
        `
    },
    'settings': {
        title: 'Pengaturan Sistem',
        html: `
        <div class="card">
            <h3>‚öôÔ∏è Pengaturan</h3>
            <p>Pengaturan tambahan akan tersedia di masa mendatang.</p>
            <div class="form-row">
                <div class="form-control">
                    <label class="document-label">
                        Mode Tampilan:
                        <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                            <i class="fas fa-moon"></i>
                        </button>
                    </label>
                </div>
            </div>
        </div>
        `
    }
};

function initializePages() {
    const mainContent = document.getElementById('mainContent');
    mainContent.innerHTML = '';
    
    // Create and append content for all pages
    for (const key in PAGES) {
        if (PAGES[key].html) {
            mainContent.innerHTML += `<div id="${key}" class="content-page">${PAGES[key].html}</div>`;
        } else {
            mainContent.innerHTML += createPageContent(key);
        }
    }
    
    // Add event listeners for form submissions
    for (const key in PAGES) {
        const page = PAGES[key];
        if (page.formId) {
            const form = document.getElementById(page.formId);
            if (form) {
                form.addEventListener('submit', async function(event) {
                    event.preventDefault();
                    if (validateForm(this)) {
                        await handleFormSubmission(key);
                    } else {
                        showNotification('Mohon lengkapi semua bidang yang wajib diisi', 'error');
                    }
                });
            }
        }
    }
}

function createPageContent(pageId) {
    const page = PAGES[pageId];
    if (!page) return '';
    
    let formHtml = '';
    const formRows = [];
    let currentRow = '<div class="form-row">';
    
    page.fields.forEach((field, index) => {
        currentRow += `
        <div class="form-control">
            <label class="document-label" for="${field.id}">${field.label}${field.required ? ' <span style="color:#e74c3c;">*</span>' : ''}</label>
            <input class="form-control" type="${field.type}" id="${field.id}" name="${field.id}" placeholder="${field.label}" ${field.required ? 'required' : ''}>
            <span class="validation-message"></span>
        </div>
        `;
        
        if ((index + 1) % 2 === 0 || index === page.fields.length - 1) {
            currentRow += '</div>';
            formRows.push(currentRow);
            currentRow = '<div class="form-row">';
        }
    });
    formHtml = formRows.join('');
    
    return `
    <div id="${pageId}" class="content-page">
        <h2>${page.title}</h2>
        <div class="form-type-indicator">
            <h3>Jenis Dokumen: ${page.title}</h3>
        </div>
        <div class="card">
            <form id="${page.formId}">
                ${formHtml}
                <button type="submit" class="btn-generate" id="generateBtn_${pageId}">
                    <i class="fas fa-file-alt"></i> Buat Dokumen & Unggah ke Google Drive
                </button>
            </form>
        </div>
        <div class="google-drive-status"></div>
        <div class="upload-status" style="display:none;"></div>
        <div class="upload-error" style="display:none;"></div>
        <div class="progress-bar" style="display:none;">
            <div class="progress-fill" id="uploadProgress_${pageId}"></div>
        </div>
        <div id="resultContainer_${pageId}" class="result-container" style="display:none;">
            <div class="card">
                <h3>Pratinjau Dokumen</h3>
                <div class="document-summary" id="docSummary_${pageId}"></div>
                <div class="preview-container">
                    <embed id="pdfPreview_${pageId}" src="" type="application/pdf">
                    <a id="downloadLink_${pageId}" href="" target="_blank" download>
                        <i class="fas fa-download"></i> Unduh Dokumen
                    </a>
                </div>
            </div>
            <div class="card">
                <h3>QR Code Dokumen</h3>
                <div class="qr-section">
                    <div id="qrcode_${pageId}" style="width:150px;height:150px;margin:0 auto;"></div>
                    <div class="qr-info">
                        <p>Pindai QR Code di atas untuk mengakses dokumen.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    `;
}

// Function to handle form submission
async function handleFormSubmission(pageId) {
    showLoading(true);
    const page = PAGES[pageId];
    const form = document.getElementById(page.formId);
    
    // Collect form data
    const formData = {};
    page.fields.forEach(field => {
        formData[field.id] = form.elements[field.id].value;
    });

    try {
        const pdfFile = await generatePDF(formData, page);
        const fileName = `${generateDocumentCode(formData[page.fields[0].id], formData[page.fields[6].id], formData[page.fields[7].id])}.pdf`;
        const folderId = FOLDER_MAP[page.folderKey];
        
        // Show progress bar
        const progressBar = document.querySelector(`#uploadProgress_${pageId}`).parentElement;
        progressBar.style.display = 'block';

        const uploadedFile = await uploadFileToGoogleDrive(pdfFile, folderId, fileName, (progress) => {
            const progressBarFill = document.getElementById(`uploadProgress_${pageId}`);
            progressBarFill.style.width = `${progress}%`;
            progressBarFill.textContent = `${Math.round(progress)}%`;
        });
        
        progressBar.style.display = 'none';

        sessionStats.documentsGenerated++;
        sessionStats.filesUploaded++;
        
        // Update UI with results
        const resultContainer = document.getElementById(`resultContainer_${pageId}`);
        resultContainer.style.display = 'block';
        
        const docSummary = document.getElementById(`docSummary_${pageId}`);
        docSummary.innerHTML = `
            <table>
                <tr><td>Jenis Dokumen</td><td>: ${page.title}</td></tr>
                <tr><td>Nama File</td><td>: ${uploadedFile.name}</td></tr>
                <tr><td>Ukuran File</td><td>: ${formatFileSize(pdfFile.size)}</td></tr>
                <tr><td>Diunggah Oleh</td><td>: ${currentUser.name}</td></tr>
                <tr><td>Waktu Unggah</td><td>: ${new Date().toLocaleString('id-ID')}</td></tr>
            </table>
        `;
        
        const previewUrl = `https://docs.google.com/gview?url=${uploadedFile.webContentLink}&embedded=true`;
        document.getElementById(`pdfPreview_${pageId}`).src = previewUrl;
        document.getElementById(`downloadLink_${pageId}`).href = uploadedFile.webContentLink;

        // Generate and display QR code
        generateQRCode(`https://drive.google.com/file/d/${uploadedFile.id}/view?usp=drivesdk`, `qrcode_${pageId}`);

        showNotification('Dokumen berhasil dibuat dan diunggah ke Google Drive', 'success');
        
    } catch (error) {
        console.error('Error during document generation or upload:', error);
        showNotification('Gagal membuat atau mengunggah dokumen: ' + error.message, 'error');
        document.querySelector(`#uploadProgress_${pageId}`).parentElement.style.display = 'none';
    } finally {
        showLoading(false);
    }
}

// Function to generate PDF
async function generatePDF(formData, page) {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');
    const margin = 20;
    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();
    const lineHeight = 10;
    
    // Document Title
    pdf.setFontSize(22);
    pdf.setFont('helvetica', 'bold');
    pdf.setTextColor(44, 62, 80);
    pdf.text('SANDAR-RATU', pageWidth / 2, margin, { align: 'center' });
    pdf.setFontSize(16);
    pdf.text('Sistem Administrasi & Dokumen Kesyahbandaran', pageWidth / 2, margin + 8, { align: 'center' });
    
    // Header Line
    pdf.setDrawColor(52, 152, 219);
    pdf.setLineWidth(1.5);
    pdf.line(margin, margin + 15, pageWidth - margin, margin + 15);
    
    // Form Type
    pdf.setFontSize(18);
    pdf.setFont('helvetica', 'normal');
    pdf.setTextColor(41, 128, 185);
    pdf.text(page.title, margin, margin + 30);
    
    let yOffset = margin + 40;
    
    // Form Data Table
    pdf.setFontSize(12);
    pdf.setTextColor(0);
    page.fields.forEach((field, index) => {
        if (yOffset > pageHeight - 50) {
            pdf.addPage();
            yOffset = margin;
        }
        pdf.setFont('helvetica', 'bold');
        pdf.text(`${field.label}:`, margin, yOffset);
        pdf.setFont('helvetica', 'normal');
        pdf.text(`${formData[field.id] || ''}`, margin + 50, yOffset);
        yOffset += lineHeight;
    });

    // Add User Info to PDF
    yOffset += 10;
    pdf.setFontSize(10);
    pdf.setTextColor(127, 140, 141);
    pdf.text(`Dokumen Dibuat Oleh: ${currentUser.name} (${currentUser.email})`, margin, yOffset);
    yOffset += 5;
    pdf.text(`Waktu: ${new Date().toLocaleString('id-ID')}`, margin, yOffset);
    
    // Add QR Code
    const qrCanvas = document.createElement('canvas');
    new QRCode(qrCanvas, {
        text: 'https://drive.google.com/file/d/DOC_ID_PLACEHOLDER/view?usp=drivesdk', // This will be updated later
        width: 100,
        height: 100
    });
    const qrImage = qrCanvas.toDataURL('image/png');
    pdf.addImage(qrImage, 'PNG', pageWidth - 50, pageHeight - 150, 40, 40);

    // Footer
    pdf.setFontSize(8);
    pdf.setTextColor(150);
    pdf.text('SANDAR-RATU ¬© 2025', margin, pageHeight - 10);
    pdf.text(`Halaman 1 dari ${pdf.internal.getNumberOfPages()}`, pageWidth / 2, pageHeight - 10, { align: 'center' });

    return new Blob([pdf.output('arraybuffer')], { type: 'application/pdf' });
}

// Function to generate QR code and update image source
function generateQRCode(url, elementId) {
    const qrcodeElement = document.getElementById(elementId);
    qrcodeElement.innerHTML = '';
    const qrcode = new QRCode(qrcodeElement, {
        text: url,
        width: 150,
        height: 150,
        colorDark : "#2c3e50",
        colorLight : "#f8f9fa",
        correctLevel : QRCode.CorrectLevel.H
    });
}

// Function to switch between pages
function showPage(pageId, element) {
    const allPages = document.querySelectorAll('.content-page');
    allPages.forEach(page => page.classList.remove('active'));
    
    const allLinks = document.querySelectorAll('.sidebar a');
    allLinks.forEach(link => link.classList.remove('active'));

    const activePage = document.getElementById(pageId);
    if (activePage) {
        activePage.classList.add('active');
        if (element) {
            element.classList.add('active');
        }
    }
}

// Initial script execution
window.onload = initializeGoogleAuth;
</script>
</body>
</html>
